---
title: "Knowledge Quiz 2"
subtitle: "KEY"
format:
  pdf: default
editor_options: 
  chunk_output_type: console
---

Please answer the following questions, render a pdf, and submit both the qmd and pdf on moodle by 11 PM on Thurs Nov 14.  Please also leave a copy of your qmd in your Submit folder on the St. Olaf RStudio server.

Guidelines: 

- No consulting with anyone else
- You may use only materials from this class (our class webpage, links on moodle, our 3 online textbooks, files posted to the RStudio server, your personal notes from class)
- No online searches or use of large language models like ChatGPT

Pledge: 

I pledge my honor that on this quiz I have neither given nor received assistance not explicitly approved by the professor and that I an aware of no dishonest work.

- type your name here to acknowledge the pledge: _________________________

- OR

- place an X here if you intentionally are not signing the pledge: _______


```{r}
#| message: false
#| warning: false

library(tidyverse)
library(rvest)
library(tidytext)

park_data <- read_csv("~/264_fall_2024/DS2_preview_work/park_data_KQ2.csv")
#park_data <- read_csv("~/Sds 264 F24/Class/Data/park_data_KQ2.csv")
```

## National Park Data

`park_data` is a 54x3 tibble containing information scraped from national park webpages for a past SDS264 final project.  A few notes about the 3 columns:

- `park_code` is a 4-letter code used as a key when merging files

- `address` is comprised of 4 pieces (described from *right* to *left*):
  - the final piece (following a comma and space) is a zip code (usually 5 digits but sometimes 5 digits then a dash then 4 more digits)
  - the 2nd to last piece is the state (an abbreviation with 2 capital letters)
  - the 3rd to last piece is the city (usually one or two words long, occasionally 3; always follows two or more spaces)
  - the first piece is the street address (often a number and a street, but will always be followed by at least two spaces)

- `activities` is a string of activities offered at each park, where activities are separated by commas


## Quiz Questions

Please answer the following questions using your knowledge of strings, regular expressions, and text analysis.  Please use `stringr` functions as much as possible, aim for efficient code, and use good style to make your code as readable as possible!


### Section 1

1. Find the subset of all `address` entries that contain a direction (north, south, east, or west).

```{r}
str_subset(str_to_lower(park_data$address), "north|south|east|west")
```


2. Produce a tibble showing how often each of the 4 directions from (1) occurs among the 54 `address` entries.  Which direction is most common?

```{r}
park_data |>
  mutate(
    address_low = str_to_lower(address),
    north = str_count(address_low, "north"),
    south = str_count(address_low, "south"),
    east = str_count(address_low, "east"),
    west = str_count(address_low, "west")
  ) |>
  summarize(
    north = sum(north),
    south = sum(south),
    east = sum(east),
    west = sum(west)
  )
```


3. Create a new tibble containing only national parks in Alaska (AK) and Hawaii (HI).

```{r}
park_data |>
  filter(str_detect(address, "AK|HI"))
```


### Section 2

4. Build a tibble which adds 4 columns to `park_data`:

- street_address
- city
- state
- zip_code

Hint: sometimes you can extract more than you want, and then remove the extra stuff...

```{r}
four_pieces <- park_data |>
  mutate(
    street_address = str_trim(str_extract(address, "^.*( ){2,}")),
    city = str_trim(str_extract(address, "( ){2,}.*[A-Z]{2}")),
    city = str_replace(city, " [A-Z]{2}", ""),
    state = str_extract(address, "[A-Z]{2},"),
    state = str_replace(state, ",", ""),
    zip_code = str_extract(address, "[\\d-]+$")
  ) |>
  select(address, street_address, city, state, zip_code)

four_pieces
```


[SKIP] If you had trouble producing the tibble in (4), you can read in the correct tibble using the R chunk below (use ONLY if needed!):

```{r}
#four_pieces <- read_csv("~/264_fall_2024/DS2_preview_work/four_pieces.csv")
#four_pieces <- read_csv("~/Sds 264 F24/Class/Data/four_pieces.csv")
```


Use your new tibble from (4) to answer Questions (5) and (6).  

5. Print the subset of `street_address` entries where the numerical part is 1000 or greater.

```{r}
str_subset(four_pieces$street_address, "^\\d{4,}")
```


6. Arrange `city` names from longest to shortest.

```{r}
four_pieces |>
  mutate(city_length = str_length(city)) |>
  select(city, city_length) |>
  arrange(desc(city_length)) |>
  print(n = Inf)
```


### Section 3

7. Create a new column in `park_data` which records the total number of activities in each park, then sort the parks from most activities to least.

```{r}
park_data |>
  mutate(num_activities = str_count(activities, ",") + 1) |>
  arrange(desc(num_activities))
```


8. Pick off all of the activities that end in "ing"; we'll refer to these as "verb activities".  Produce a count of the number of parks where each "verb activity" appears, and print the "verb activities" and their counts in order from most parks to fewest. (Note that you should consider something like "Group Camping" as different from "RV Camping" or just plain "Camping".)  Your answer should look like the tibble below:

```{r}
#| eval: FALSE

# A tibble: 57 × 2
   verb_activity              n
   <chr>                  <int>
 1 Hiking                    50
 2 Shopping                  46
 3 Stargazing                34
 4 Wildlife Watching         31
 5 Camping                   30
 6 Scenic Driving            26
 7 Horse Trekking            23
 8 Canoe or Kayak Camping    22
 9 Group Camping             22
10 Paddling                  21
# ℹ 47 more rows```
```

Hint: if you produce a list where each element in the list is a vector (with differing numbers of strings), you can use `unlist` to produce a single character vector

```{r}
#Approach 1
#str_view(park_data$activities, "([A-Z][a-z\\- ]*)* [A-Z][a-z]+ing\\b")

activities_vector <- unlist(str_extract_all(park_data$activities, "([A-Z][a-z\\- ]*)* [A-Z][a-z]+ing\\b"))

verb_activity2 <- unlist(str_extract_all(park_data$activities, 
                        "([A-Z][a-z\\- ]*)* [A-Z][a-z]+ing\\b"))
verb_activity2 <- str_remove(verb_activity2, "^ ")
park_verbs2 <- tibble(verb_activity = verb_activity2) |>
  count(verb_activity) |>
  arrange(desc(n))

#print(park_verbs2, n = Inf)


#Approach 2
#str_view(park_data$activities, "\\b[A-Za-z\\s\\-\\(\\)\\/]+ing\\b")

list_verbs <- str_extract_all(park_data$activities, "\\b[A-Za-z\\s\\-\\(\\)\\/]+ing\\b")

verbs <- as.tibble((unlist(list_verbs))) |>
  mutate(verb_activity = value) |>
  count(verb_activity) |>
  arrange(desc(n))

#print(verbs, n = Inf)


# Final approach
activities <- str_trim(unlist(str_split(park_data$activities, ",")))
park_verbs <- tibble(verb_activity = activities) |>
  mutate(verb_activity = str_trim(
    str_replace(verb_activity, "\\(.*\\)", ""))) |>
  filter(str_detect(verb_activity, "ing$")) |>
  count(verb_activity) |>
  arrange(desc(n))

#print(park_verbs, n = Inf)

# Biggest issue: Horse Camping (see also camping) and Horse Camping
#   (see also Horse/Stock Use) get both counted as Horse Camping,
#   and if a park has both, Horse Camping gets counted twice.

# Comparisons:
temp1 <- full_join(park_verbs, park_verbs2, 
                   by = c("verb_activity"="verb_activity"))
temp2 <- full_join(temp1, verbs, 
                   by = c("verb_activity"="verb_activity"))
print(temp2, n = Inf)
```


Use your tibble from (8) to answer Questions (9)-(10).  

[SKIP] If you had trouble producing the tibble in (8), you can read in the correct tibble using the R chunk below (use ONLY if needed!):

```{r}
#active_counts <- read_csv("~/264_fall_2024/DS2_preview_work/active_counts.csv")
#active_counts <- read_csv("~/Sds 264 F24/Class/Data/active_counts.csv")
```


9. Print all the "verb activities" that have a capital letter / lower case letter combination that repeats later in the phrase (e.g. "Gh" appears twice).

```{r}
str_subset(park_verbs$verb_activity, "([A-Z][a-z]).*\\1")
```


10. Print all the "verb activities" that have the same consonant appear twice in a row.

```{r}
str_subset(str_to_lower(park_verbs$verb_activity), "([^aeiou])\\1")
```

